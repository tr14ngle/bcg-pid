#define SET_HIGH(port, pin) (PORT ## port |= (1 << pin))
#define SET_LOW(port, pin) ((PORT ## port) &= ~(1 << (pin)))
#define TOGGLE(port, pin) (PORT ## port) ^= (1 << (pin))
#define READ(port, pin) (PIN ## port & (1 << pin))
#define SET_PIN_MODE(port, pin, mode) \
  if (mode == INPUT) { \
    DDR ## port &= ~(1 << pin); \
  } else if (mode == OUTPUT) { \
    DDR ## port |= (1 << pin); \
  }

void setup() {
    SET_PIN_MODE(D,2,OUTPUT); //D2
    SET_PIN_MODE(D,3,OUTPUT); //D3
    SET_PIN_MODE(D,4,OUTPUT); //D4
    SET_PIN_MODE(D,6,OUTPUT); //D6
    SET_PIN_MODE(D,7,OUTPUT); //D7
    SET_PIN_MODE(B,0,OUTPUT); //D8
    SET_PIN_MODE(B,1,OUTPUT); //D9

    pinMode(0,INPUT_PULLUP);
    pinMode(1,INPUT_PULLUP);
    Serial.begin(9600);
  }

  void loop() {

  uint8_t button1 = 1;
  uint8_t button2 = 1;

  uint8_t lastB1 = 1;
  uint8_t lastB2 = 1;
  int8_t relaystate = 0;

  SET_HIGH(D,2);
  SET_HIGH(D,3);
  delay(1000);
  SET_LOW(D,2);
  SET_LOW(D,3);

  delay(500);

  SET_HIGH(D,4);
  delay(500);
  SET_LOW(D,4);
  delay(500);
  SET_HIGH(D,6);
  delay(500);
  SET_LOW(D,6);
  delay(500);
  SET_HIGH(D,7);
  delay(500);
  SET_LOW(D,7);
  delay(500);
  SET_HIGH(B,0);
  delay(500);
  SET_LOW(B,0);
  delay(500);
  SET_HIGH(B,1);
  delay(500);
  SET_LOW(B,1);
  delay(500);
  //

  for(int i=0;i<=2;i++){
      SET_HIGH(D,4);
      delay(50);
      SET_LOW(D,4);
      delay(50);
      SET_HIGH(D,6);
      delay(50);
      SET_LOW(D,6);
      delay(50);
      SET_HIGH(D,7);
      delay(50);
      SET_LOW(D,7);
      delay(50);
      SET_HIGH(B,0);
      delay(50);
      SET_LOW(B,0);
      delay(50);
      SET_HIGH(B,1);
      delay(150);
      SET_LOW(B,1);
      delay(50);
  }



  SET_HIGH(D,2);
  while(true){

    //Serial.print("BTN1:");
    //Serial.print(button1);

    //Serial.print(", BTN2:");
    //Serial.println(button2);

    //Serial.print("relaystate: ");
    //Serial.println(relaystate);

    lastB1=button1;
    lastB2=button2;

    button1=READ(D,0);
    button2=READ(D,1);

    if((button1!=lastB1) && (button1==0)){
        delay(40);
        relaystate++;
    }

    if((button2!=lastB2) && (button2==0)){
        delay(40);
        relaystate--;  
    }

    if(relaystate>6){
      relaystate=0;
    }

    if(relaystate<0){
      relaystate=5;
    }

    switch(relaystate){
        case 0:
          SET_LOW(D,4);
          SET_LOW(D,6);
          SET_LOW(D,7);
          SET_LOW(B,0);
          SET_LOW(B,1);
        break;

        case 1:
          SET_HIGH(D,4);
          SET_HIGH(D,6);
          SET_HIGH(D,7);
          SET_HIGH(B,0);
          SET_HIGH(B,1);
        break;

        case 2:
          SET_HIGH(D,4);
          SET_LOW(D,6);
          SET_LOW(D,7);
          SET_LOW(B,0);
          SET_LOW(B,1);
        break;

        case 3:
          SET_LOW(D,4);
          SET_HIGH(D,6);
          SET_LOW(D,7);
          SET_LOW(B,0);
          SET_LOW(B,1);
        break;

        case 4:
          SET_LOW(D,4);
          SET_LOW(D,6);
          SET_HIGH(D,7);
          SET_LOW(B,0);
          SET_LOW(B,1);
        break;

        case 5:
          SET_LOW(D,4);
          SET_LOW(D,6);
          SET_LOW(D,7);
          SET_HIGH(B,0);
          SET_LOW(B,1);
        break;

        case 6:
          SET_LOW(D,4);
          SET_LOW(D,6);
          SET_LOW(D,7);
          SET_LOW(B,0);
          SET_HIGH(B,1);
        break;
    }
    

  }


}
